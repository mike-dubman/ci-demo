---
job: baremetal

registry_host: harbor.mellanox.com
registry_path: /swx-storage/ci-demo
registry_auth: swx-storage

kubernetes:
  cloud: 'swx-k8s-spray'

runs_on_dockers:
  - {name: 'blackduck', url: 'harbor.mellanox.com/toolbox/ngci-centos:latest', arch: 'x86_64'}
  - {file: '.ci/Dockerfile.ubuntu18-4', name: 'ubuntu18-4', tag: 'latest', arch: 'x86_64'}
  
runs_on_agents:
  - nodeLabel: '(dockerserver || docker) && x86_64'
  - nodeLabel: 'hpc-test-node-inbox'

steps:

- name: step1
  run: |
    hostname
    echo pwd=$PWD -- ws=$WORKSPACE

- name: step2
  run: |
    env
    echo pwd=$PWD -- ws=$WORKSPACE

- name: run once
  agentSelector: "{nodeLabel: 'hpc-test-node-inbox'}"
  run: |
    ls
    echo pwd=$PWD -- ws=$WORKSPACE


pipeline_start:
  run: |
    echo Starting pipeline
    echo pwd=$PWD -- ws=$WORKSPACE
    env

pipeline_stop:
  run: 
    echo pipeline_status=$pipeline_status
    echo pwd=$PWD -- ws=$WORKSPACE
    echo all done

